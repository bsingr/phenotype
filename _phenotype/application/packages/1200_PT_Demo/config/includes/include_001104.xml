<?xml version="1.0" encoding="ISO-8859-1" ?>
<phenotype>
	<meta>
		<ptversion>##!PT_VERSION!##</ptversion>
		<ptsubversion>##!BUILD_NO!##</ptsubversion>
		<inc_id>1104</inc_id>
		<inc_bez>Formular</inc_bez>		
		<inc_rubrik>Kontakt</inc_rubrik>
		<inc_description></inc_description>
		<inc_usage_layout>0</inc_usage_layout>
		<inc_usage_includecomponent>1</inc_usage_includecomponent>
		<inc_usage_page>0</inc_usage_page>
	</meta>
	<script>&#60;?

class PhenotypeInclude_1104 extends PhenotypeInclude
{
	&#47;&#47; Kontaktformular

	public $id = 1104;

	function display()
	{
		global $myRequest;
		
		if ($myRequest-&#62;get(&#34;action&#34;)==&#34;sendForm&#34;)
		{
			$this-&#62;sendForm();
		}
		else 
		{
			&#47;&#47; Notwendig, um die Smartyengine richtig zu initialisieren
			eval ($this-&#62;initRendering());
			
			$this-&#62;displayFormHeader();
			$this-&#62;displayFormJSChecks();
			
			echo $mySmarty-&#62;fetch($TPL_FORM);

			$this-&#62;displayFormFooter();
		}
	}

	function displayFormHeader()
	{
		global $myPage;

		echo &#39;&#60;form action=&#34;index.php&#34; method=&#34;post&#34; enctype=&#34;multipart&#47;form-data&#34; onsubmit=&#34;return formcheck();&#34; name=&#34;form1&#34;&#62;&#39;;
		echo &#39;&#60;input type=&#34;hidden&#34; name=&#34;id&#34; value=&#34;&#39; . $myPage-&#62;id .&#39;&#34;&#47;&#62;&#39;;
		echo &#39;&#60;input type=&#34;hidden&#34; name=&#34;action&#34; value=&#34;sendForm&#34;&#47;&#62;&#39;;
	}

	function displayFormJSChecks()
	{
		?&#62;
		&#60;script type=&#34;text&#47;javascript&#34;&#62;
		function formcheck()
		{
			if (!check_text (&#39;name&#39;,&#39;Bitte geben Sie Ihren Namen an.&#39;)){return false};
			if (!check_email (&#39;email&#39;,&#39;Bitte geben Sie Ihre E-Mail-Adresse an.&#39;,&#39;Bitte geben Sie eine gültige E-Mail-Adresse an.&#39;)){return false};
		}
		function check_text(feld,meldung){  if (document.forms.form1[feld].value==&#39;&#39;)  {    alert (meldung);document.forms.form1[feld].focus();return false;  }  return true;}
		
		function check_email(feld,meldung1,meldung2){  email = document.forms.form1[feld].value;  if (email==&#39;&#39;)  {    alert (meldung1);document.forms.form1[feld].focus();return false;   }  if (email.indexOf(&#39;@&#39;)==-1)  {    alert (meldung2);document.forms.form1[feld].focus();return false;   }   if (email.indexOf(&#39;.&#39;)==-1)  {    alert (&#39;Bitte geben Sie eine gültige E-Mail-Adresse an.&#39;);document.forms.form1[feld].focus();return false;   }      return true;}
		
		function check_2text(feld1,feld2,meldung){  if ((document.forms.form1[feld1].value==&#39;&#39;) &#38;(document.forms.form1[feld2].value==&#39;&#39;))  {    alert (meldung);document.forms.form1[feld1].focus();return false;  }  return true;} 
		
		function check_selection(feld,meldung){  if (document.forms.form1[feld].selectedIndex==0)  {    alert (meldung);document.forms.form1[feld].focus();return false;   }  return true;} 
		
		function check_box(feld,meldung){  if (!document.forms.form1[feld].checked)  {    alert (meldung);return false;   }  return true;} 
		
		function check_number(feld,meldung){  if (isNaN(document.forms.form1[feld].value))  {    alert (meldung);document.forms.form1[feld].focus();return false;  }  return true;} 
	&#60;&#47;script&#62;
		&#60;?
	}

	function displayFormFooter()
	{
		echo &#39;&#60;&#47;form&#62;&#39;;
	}
	
	function sendForm()
	{
		global $myRequest;
		global $myApp;
		
        
        $mail = &#34;======================================================\n&#34;;
        $mail .= &#34;Eintrag in Kontaktformular\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;Datum : &#34;.date(&#34;d.m.Y H:i&#34;).&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;IP    : &#34;.$_SERVER[&#34;REMOTE_ADDR&#34;].&#34;\n&#34;;
        $mail .= &#34;LOOKUP: &#34;.gethostbyaddr($_SERVER[&#34;REMOTE_ADDR&#34;]).&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;Server: &#34;.$_SERVER[&#34;HTTP_HOST&#34;].&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;Name  : &#34;.$myRequest-&#62;get(&#34;name&#34;).&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;Email : &#34;.$myRequest-&#62;get(&#34;email&#34;).&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;Telefon : &#34;.$myRequest-&#62;get(&#34;telefon&#34;).&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;Nachricht: \n\n&#34;.$myRequest-&#62;get(&#34;nachricht&#34;).&#34;\n&#34;;
        $mail .= &#34;------------------------------------------------------\n&#34;;
        $mail .= &#34;======================================================\n\n\n&#34;;

        $myCO = new PhenotypeContent_1102();
        $myCO-&#62;addNew(3); &#47;&#47; User WWW
        $myCO-&#62;set(&#34;bez&#34;, &#34;Eintrag von &#34;.$myRequest-&#62;get(&#34;name&#34;));
        $myCO-&#62;set(&#34;mail&#34;, $mail);
        $myCO-&#62;store();
        
        if (@mail($myApp-&#62;contact_email_to, &#34;Eintrag in Kontaktformular&#34;, $mail, $myApp-&#62;contact_email_from))
        {
           &#47;&#47; Notwendig, um die Smartyengine richtig zu initialisieren
			eval ($this-&#62;initRendering());
			echo $mySmarty-&#62;fetch($TPL_THANKYOU);
        }
        else 
        {
        	eval ($this-&#62;initRendering());
			echo $mySmarty-&#62;fetch($TPL_ERROR);
        }
	}

}
?&#62;</script>
	<templates>
<template access="TPL_ERROR">Es ist ein Fehler aufgetreten. Bitte probieren Sie es später nochmal.&#60;br&#47;&#62;&#60;br&#47;&#62;
(Hier in der Demo geht es natürlich gar nicht ;))</template>
<template access="TPL_FORM">Name*:&#60;br&#47;&#62; &#60;input type=&#34;text&#34; name=&#34;name&#34;&#47;&#62;&#60;br&#47;&#62;
Email*:&#60;br&#47;&#62; &#60;input type=&#34;text&#34; name=&#34;email&#34;&#47;&#62;&#60;br&#47;&#62;
Telefon:&#60;br&#47;&#62; &#60;input type=&#34;text&#34; name=&#34;telefon&#34;&#47;&#62;&#60;br&#47;&#62;
Ihre Nachricht:
&#60;br&#47;&#62;&#60;textarea rows=&#34;6&#34; name=&#34;nachricht&#34;&#62;&#60;&#47;textarea&#62;
&#60;br&#47;&#62;
&#60;input type=&#34;submit&#34; value=&#34;Abschicken&#34;&#47;&#62;</template>
<template access="TPL_THANKYOU">Vielen Dank für Ihre Nachricht.</template>
   	</templates>
</phenotype>