<?xml version="1.0" encoding="ISO-8859-1" ?>
<phenotype>
	<meta>
		<ext_id>1001</ext_id>
		<ext_bez>Pagewizard</ext_bez>		
		<ext_rubrik>Development</ext_rubrik>
		<ext_description></ext_description>
	</meta>
	<script>&#60;?php &#10;class PhenotypeExtra_1001 extends PhenotypeExtra&#10;{&#10;&#9;public $id = 1001;&#10;&#9;public $bez = &#34;Pagewizard&#34;;&#10;&#9;public $configure_tab  =0;&#10;&#10;&#9;function displaySetup()&#10;&#9;{&#10;&#9;}&#10;&#10;&#9;function storeConfig()&#10;&#9;{&#10;&#9;&#9;$this-&#62;store();&#10;&#9;}&#10;&#10;&#9;function displayInfo()&#10;&#9;{&#10;&#9;&#9;global $myLayout;&#10;&#9;&#9; ?&#62;&#10;&#9;&#9;&#60;table width=&#34;100%&#34; border=&#34;0&#34; cellpadding=&#34;0&#34; cellspacing=&#34;0&#34;&#62;&#10;        &#60;tr&#62;&#10;        &#60;td class=&#34;tableBody&#34;&#62;&#10;        Mit dem Pagewizard können Sie auf sehr einfache Weise Seitenbäume anlegen.&#60;&#47;br&#62;&#10;        Schreiben Sie die Seitentitel einfach in einer Liste untereinander auf. Mit Leerzeichen rücken Sie&#60;&#47;br&#62;&#10;        Seiten ein, so         dass sie im Baum eine Ebene tiefer eingehängt werden.&#60;&#47;br&#62; &#10;        &#60;&#47;br&#62;&#10;        Beispiel: &#60;&#47;br&#62;&#60;&#47;br&#62;&#10;        Home&#60;&#47;br&#62;&#10;        &#38;nbsp;Seite 1&#60;&#47;br&#62;&#10;        &#38;nbsp;Seite 2&#60;&#47;br&#62;&#10;        &#38;nbsp;&#38;nbsp;Seite 2.1&#60;&#47;br&#62;&#10;        &#38;nbsp;Seite 3&#60;&#47;br&#62;&#10;        &#60;&#47;br&#62;&#10;        &#60;&#47;br&#62;&#10;        Alle Seiten werden abhängig davon, welche Einstellungen sie hier vornehmen, angelegt. Sie können&#10;        einzelnen Seiten zusätzlich ein abweichendes Layout und einen abweichenden On&#47;Offline-Status geben:&#60;&#47;br&#62;&#10;        &#60;&#47;br&#62;&#10;        Beispiel: &#60;&#47;br&#62;&#10;        Seite1 || 6 0&#60;&#47;br&#62;&#10;        Seite2 || 4 1&#60;&#47;br&#62;&#60;&#47;br&#62;&#10;        Bei diesem Beispiel wird Seite1 mit dem Layout und Seite2 mit dem Layout4 angelegt. Seite 1 wird offline gestellt, Seite 2 online.&#10;        &#60;&#47;br&#62;&#10;        &#60;&#47;td&#62;&#10;        &#60;&#47;tr&#62;&#10;        &#60;&#47;table&#62;&#10;        &#60;?php &#10;&#10;&#9;}&#10;&#9;function displayStart()&#10;&#9;{&#10;&#9;&#9;global $myLayout;&#10;&#9;&#9;global $myPT;&#10;&#9;&#9;global $myDB;&#10;&#10;&#9;&#9;$myLayout-&#62;workarea_start_draw();&#10;&#9;&#9; ?&#62;&#10;&#9;&#9;&#60;form action=&#34;extra_execute.php&#34; method=&#34;post&#34;&#62;&#10;&#9;&#9;&#60;input type=&#34;hidden&#34; name=&#34;id&#34; value=&#34;&#60;?php echo $this-&#62;id ?&#62;&#34;&#62;&#10;&#9;&#9;&#60;?php &#10;&#9;&#9;&#10;&#9;&#9;$sql = &#34;SELECT * FROM pagegroup ORDER BY grp_bez&#34;;&#10;&#9;&#9;$rs = $myDB-&#62;query($sql);&#10;&#9;&#9;$options = &#34;&#34;;&#10;&#9;&#9;$options .= &#39;&#60;option value=&#34;0&#34;&#62;--------------------------------&#60;&#47;option&#62;&#39;;&#10;&#9;&#9;while ($row = mysql_fetch_array($rs))&#10;&#9;&#9;{&#10;&#9;&#9;&#9;$options .= &#39;&#60;option value=&#34;g&#39;.$row[&#34;grp_id&#34;].&#39;&#34;&#62;Gruppe: &#39;.$row[&#34;grp_bez&#34;].&#39;&#60;&#47;option&#62;&#39;;&#10;&#9;&#9;}&#10;&#9;&#9;$sql = &#34;SELECT * FROM page ORDER BY grp_id,pag_bez&#34;;&#10;&#9;&#9;$rs = $myDB-&#62;query($sql);&#10;&#9;&#9;$grp_id = 0;&#10;&#9;&#9;while ($row = mysql_fetch_array($rs))&#10;&#9;&#9;{&#10;&#9;&#9;&#9;if ($row[&#34;grp_id&#34;] != $grp_id)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$grp_id = $row[&#34;grp_id&#34;];&#10;&#9;&#9;&#9;&#9;$options .= &#39;&#60;option value=&#34;0&#34;&#62;--------------------------------&#60;&#47;option&#62;&#39;;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;$options .= &#39;&#60;option value=&#34;&#39;.$row[&#34;pag_id&#34;].&#39;&#34;&#62;&#39;.$row[&#34;pag_bez&#34;].&#39;&#60;&#47;option&#62;&#39;;&#10;&#9;&#9;}&#10;&#9;&#9;$options .= &#39;&#60;option value=&#34;0&#34;&#62;--------------------------------&#60;&#47;option&#62;&#39;;&#10;&#10;&#9;&#9;$html = $myLayout-&#62;workarea_form_select(&#34;&#34;, &#34;pag_id&#34;, $options, $x);&#10;&#9;&#9;$myLayout-&#62;workarea_row_draw(&#34;Referenzseite&#34;, $html);&#10;&#10;&#9;&#9;$_options = Array (1 =&#62; &#34;Nach ausgewählter Seite, gleiche Ebene&#34;, 2 =&#62; &#34;Vor ausgewählter Seite, gleiche Ebene&#34;, 3 =&#62; &#34;Unterhalb der Seite, eine Ebene tiefer&#34;);&#10;&#9;&#9;$options = $myPT-&#62;buildOptionsByNamedArray($_options, &#34;&#34;);&#10;&#9;&#9;$html = $myLayout-&#62;workarea_form_select(&#34;&#34;, &#34;insertorder&#34;, $options, $x);&#10;&#9;&#9;$myLayout-&#62;workarea_row_draw(&#34;Einordnung&#34;, $html);&#10;&#10;&#9;&#9;$sql = &#34;SELECT * FROM layout ORDER BY lay_bez&#34;;&#10;&#9;&#9;$rs = $myDB-&#62;query($sql);&#10;&#9;&#9;$_options = Array ();&#10;&#9;&#9;$_options[] = &#34;kein Template&#34;;&#10;&#9;&#9;while ($row = mysql_fetch_array($rs))&#10;&#9;&#9;{&#10;&#9;&#9;&#9;$_options[$row[&#34;lay_id&#34;]] = $row[&#34;lay_bez&#34;];&#10;&#9;&#9;}&#10;&#9;&#9;$options = $myPT-&#62;buildOptionsByNamedArray($_options, &#34;&#34;);&#10;&#9;&#9;$html = $myLayout-&#62;workarea_form_select(&#34;&#34;, &#34;lay_id&#34;, $options, $x);&#10;&#9;&#9;$myLayout-&#62;workarea_row_draw(&#34;Layout&#34;, $html);&#10;&#10;&#9;&#9;$html = $myLayout-&#62;workarea_form_checkbox(&#34;&#34;, &#34;online&#34;, 1, online);&#10;&#9;&#9;$myLayout-&#62;workarea_row_draw(&#34;Status&#34;, $html);&#10;&#10;&#9;&#9;$html = $myLayout-&#62;workarea_form_textarea(&#34;&#34;, &#34;tree&#34;, &#34;&#34;, 20, 395);&#10;&#9;&#9;$myLayout-&#62;workarea_row_draw(&#34;Seitenbaum&#34;, $html);&#10;&#10;&#9;&#9;$myLayout-&#62;workarea_whiteline();&#10; ?&#62;&#10;&#9;&#9;&#9; &#60;table width=&#34;100%&#34; border=&#34;0&#34; cellpadding=&#34;0&#34; cellspacing=&#34;0&#34;&#62;&#10;          &#60;tr&#62;&#10;            &#60;td class=&#34;windowFooterWhite&#34;&#62;&#38;nbsp;&#60;&#47;td&#62;&#10;            &#60;td align=&#34;right&#34; class=&#34;windowFooterWhite&#34;&#62;&#10;&#9;&#9;&#9;&#38;nbsp;&#38;nbsp;&#60;input name=&#34;save&#34; type=&#34;submit&#34; class=&#34;buttonWhite&#34; style=&#34;width:102px&#34;value=&#34;Start&#34;&#62;&#38;nbsp;&#38;nbsp;&#10;            &#60;&#47;td&#62;&#10;          &#60;&#47;tr&#62;&#10;        &#60;&#47;table&#62;&#10;        &#60;&#47;form&#62;&#10;&#9;&#9;&#60;?php &#10;&#10;&#10;&#9;&#9;$myLayout-&#62;workarea_stop_draw();&#10;&#9;}&#10;&#10;&#9;function execute($myRequest)&#10;&#9;{&#10;&#9;&#9;global $myLayout;&#10;&#9;&#9;$myLayout-&#62;workarea_start_draw();&#10;&#9;    ?&#62;&#10;&#9;    &#60;table width=&#34;100%&#34; border=&#34;0&#34; cellpadding=&#34;0&#34; cellspacing=&#34;0&#34;&#62;&#10;        &#60;tr&#62;&#10;        &#60;td class=&#34;tableBody&#34;&#62;&#10;        &#60;?php &#10;&#9;&#9;$this-&#62;buildPages();&#10;&#9;&#9; ?&#62;&#10;&#9;&#9;&#60;&#47;td&#62;&#10;          &#60;&#47;tr&#62;&#10;        &#60;&#47;table&#62;&#10;&#9;&#9;&#60;?php &#10;&#9;&#9;$myLayout-&#62;workarea_whiteline();&#10;&#9;&#9;$myLayout-&#62;workarea_stop_draw();&#10;&#9;}&#10;&#9;&#10;&#9;function buildPages()&#10;&#9;{&#10;&#9;&#9;global $myRequest;&#10;&#9;&#9;global $myDB;&#10;&#9;&#9;&#9;    &#9;&#9;&#10;&#9;&#9;$pag_id = $myRequest-&#62;get(&#34;pag_id&#34;);&#10;&#10;&#9;&#9;&#47;&#47; Array aufbauen&#10;&#9;&#9;&#10;&#9;&#9;$lastlevel=0;&#10;&#9;&#9;&#10;&#9;&#9;$s = $myRequest-&#62;get(&#34;tree&#34;);&#10;&#9;&#9;$_tree= Array();&#10;&#9;&#9;$s =explode(&#34;\n&#34;,$s);&#10;&#9;&#9;$i=0;&#10;&#9;&#9;foreach ($s as $k)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;$i++;&#10;&#9;&#9;&#9;$lay_id = $myRequest-&#62;getI(&#34;lay_id&#34;);&#10;&#9;&#9;&#9;$status = $myRequest-&#62;getI(&#34;online&#34;);&#10;&#9;&#9;&#9;$k = str_replace (chr(10),&#34;&#34;,$k);&#10;&#9;&#9;&#9;$k = str_replace (chr(13),&#34;&#34;,$k);&#10;&#9;&#9;&#9;$level = 0;&#10;&#9;&#9;&#9;while (substr($k,$level,1)==&#34; &#34;)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$level++;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;$k = trim($k);&#10;&#9;&#9;&#9;$p = strpos($k,&#34;||&#34;);&#10;&#9;&#9;&#9;if ($p!==false)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$params = substr($k,$p+2);&#10;&#9;&#9;&#9;&#9;$params = trim($params);&#10;&#9;&#9;&#9;&#9;$k = substr($k,0,$p);&#10;&#9;&#9;&#9;&#9;&#10;&#9;&#9;&#9;&#9;$p = strpos($params,&#34; &#34;);&#10;&#9;&#9;&#9;&#9;if ($p!==false)&#10;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;$lay_id = (int)substr($params,0,$p);&#10;&#9;&#9;&#9;&#9;&#9;$status = (int)substr($params,$p+1);&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;$lay_id = (int)$params;&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;if ($k!=&#34;&#34;)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;  &#10;&#9;&#9;&#9;  &#47;&#47; Korrigiert unmögliche Baumstrukturen&#10;&#9;&#9;&#9;  if ($level&#62;$lastlevel+1)&#10;&#9;&#9;&#9;  {&#10;&#9;&#9;&#9;  &#9;$level=$lastlevel+1;&#10;&#9;&#9;&#9;  }&#10;&#9;&#9;&#9;  if ($i==1)&#10;&#9;&#9;&#9;  {&#10;&#9;&#9;&#9;  &#9;$level=0;&#10;&#9;&#9;&#9;  }&#10;&#9;&#9;&#9;  &#47;&#47; -- Unmögliche Baumstrukturen&#10;&#9;&#9;&#9;  &#10;&#9;&#9;&#9;  $_tree[] = Array($level,$k,$lay_id,$status);&#10;&#9;&#9;&#9;  $lastlevel=$level;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;}&#10;&#10;&#10;&#10;&#9;&#9;$_parents = Array();&#10;&#9;&#9;$lastlevel=0;&#10;&#9;&#9;$push=0;&#10;&#9;&#9;$n=0;&#10;&#9;&#9;$c=count($_tree);&#10;&#9;&#9;for ($i=0;$i&#60;$c;$i++)&#10;&#9;&#9;{&#10;&#9;&#9;&#9;$_page = $_tree[$i];&#10;&#9;&#9;&#9;$level = $_page[0];&#10;&#9;&#9;&#9;$bez = $_page[1];&#10;&#9;&#9;&#9;$lay_id = $_page[2];&#10;&#9;&#9;&#9;$status = $_page[3];&#10;&#9;&#9;&#9;$insertorder = 1; &#47;&#47; nach der letzten Seite&#10;&#10;&#9;&#9;&#9;&#47;&#47; Erste Seite ermitteln&#10;&#9;&#9;&#9;if ($i==0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;  if (strpos($pag_id,&#34;g&#34;)===0)&#10;&#9;&#9;&#9;  {&#10;&#9;&#9;&#9;    $grp_id = (int)substr($pag_id,1);&#10;&#9;&#9;&#9;    &#10;&#9;&#9;&#9;    &#47;&#47; Check, ob in der Gruppe schon Seiten sind !!&#10;&#9;&#9;&#9;    $sql = &#34;SELECT * FROM page WHERE grp_id = &#34; . $grp_id . &#34; AND pag_id_top=0 ORDER BY pag_pos DESC&#34;;&#10;&#9;&#9;&#9;    $rs = $myDB-&#62;query($sql);&#10;&#9;&#9;&#9;    if (mysql_num_rows($rs)==0)&#10;&#9;&#9;&#9;    {&#10;&#9;&#9;&#9;      &#9;$_parents[] = 0;&#10;&#9;&#9;&#9;      &#9;$insertorder = 3;&#10;&#9;&#9;&#9;    }&#10;&#9;&#9;&#9;    else&#10;&#9;&#9;&#9;    {&#10;&#9;&#9;&#9;    &#9;$row = mysql_fetch_array($rs);&#10;&#9;&#9;&#9;    &#9;$_parents[] = $row[&#34;pag_id&#34;];&#10;&#9;&#9;&#9;    &#9;$insertorder = 1;&#10;&#9;&#9;&#9;    }&#10;&#9;&#9;&#9;  }&#10;&#9;&#9;&#9;  else&#10;&#9;&#9;&#9;  {&#10;&#9;&#9;&#9;  &#9;&#47;&#47; Abfangen pag_id=0;&#10;&#9;&#9;&#9;  &#9;if ($myRequest-&#62;getI(&#34;pag_id&#34;)==0)&#10;&#9;&#9;&#9;  &#9;{&#10;&#9;&#9;&#9;  &#9;&#9;echo &#34;Sie müssen entweder eine Seite oder eine Seitengruppe auswählen.&#34;;&#10;&#9;&#9;&#9;  &#9;&#9;return false;&#10;&#9;&#9;&#9;  &#9;}&#10;&#9;&#9;&#9;  &#9;&#10;&#9;&#9;&#9;  &#9;$grp_id =NULL;&#10;&#9;&#9;&#9;  &#9;$_parents[] = $myRequest-&#62;getI(&#34;pag_id&#34;);&#10;&#9;&#9;&#9;  &#9;$insertorder = $myRequest-&#62;getI(&#34;insertorder&#34;);&#10;&#9;&#9;&#9;  }&#10;&#9;&#9;&#9;}&#10;&#9;&#10;&#9;&#9;&#9;&#47;&#47; -- Erste Seite ermitteln&#10;&#9;&#9;&#9;if ($level&#62;$lastlevel)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$insertorder = 3;&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;$downgrade=0;&#10;&#9;&#9;&#9;if ($level&#60;$lastlevel)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$n=$i;&#10;&#9;&#9;&#9;&#9;while ($n&#62;0)&#10;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;$n--;&#10;&#9;&#9;&#9;&#9;&#9;$backlevel = $_tree[$n][0];&#10;&#9;&#9;&#9;&#9;&#9;if ($backlevel==$level)&#10;&#9;&#9;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;&#9;&#9;break;&#10;&#9;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#9;&#9;$downgrade++;&#10;&#9;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;$c2 = count($_parents);&#10;&#9;&#9;&#9;$pag_id_parent = $_parents[$c2-1-$downgrade];&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;echo &#34;Seite &#60;strong&#62;&#34; . $bez . &#34;&#60;&#47;strong&#62; angelegt.&#60;br&#47;&#62;&#34;;&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;$myPage = new PhenotypePage();&#10;&#9;&#9;&#9;if ($pag_id_parent==0)&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$id = $myPage-&#62;newPage_FirstInGroup($grp_id);&#10;&#9;&#9;&#9;}&#10;&#9;&#9;&#9;else&#10;&#9;&#9;&#9;{&#10;&#9;&#9;&#9;&#9;$id = $myPage-&#62;newPage_RelatedToExisitingPage($pag_id_parent,$insertorder);&#10;&#9;&#9;&#9;}&#10;&#10;&#9;&#9;&#9;$_parents[] = $id;&#10;&#9;&#9;&#9;$lastlevel=$level;&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;$myPage-&#62;init($id);&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;$mySQL = new SQLBuilder();&#10;&#9;&#9;&#9;$mySQL-&#62;addField(&#34;pag_bez&#34;,$bez);&#10;&#9;&#9;&#9;$mySQL-&#62;addField(&#34;pag_titel&#34;,$bez);&#10;&#9;&#9;&#9;$mySQL-&#62;addField(&#34;pag_status&#34;,$status);&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;$sql = $mySQL-&#62;update(&#34;page&#34;,&#34;pag_id=&#34;.$myPage-&#62;id);&#10;&#9;&#9;&#9;$myDB-&#62;query($sql);&#10;&#9;&#9;&#9;&#10;&#9;&#9;&#9;$mySQL = new SQLBuilder();&#10;&#9;&#9;&#9;$mySQL-&#62;addField(&#34;lay_id&#34;,$lay_id);&#10;&#9;&#9;&#9;$sql = $mySQL-&#62;update(&#34;pageversion&#34;,&#34;ver_id=&#34;.$myPage-&#62;ver_id);&#10;&#9;&#9;&#9;$myDB-&#62;query($sql);&#10;&#10;&#9;&#9;&#9;$myPage-&#62;buildProps();&#10;&#10;&#10;&#9;&#9;}&#9;&#9;&#10;&#9;&#9;&#10;&#10;&#9;}&#10;&#10;}&#10; ?&#62;</script>
	<templates>
   	</templates>
		<ext_props></ext_props>
</phenotype>